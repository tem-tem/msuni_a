<% content_for :title do %>
  <title><%= @lecture.title %></title>
<% end %>

<div class="modal fade bring-to-front" id="presModal"
     tabindex="-1"
     role="dialog"
     aria-labelledby="presModal"
     aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-title text-secondary" id="presModalLabel">Новая презентация</div>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body" id="presModalBody">
        <!-- Здесь форма -->
      </div>
    </div>
  </div>
</div>

<div class="container">
  <div class="row justify-content-center">

    <div class="col-xl-8 col-lg-9 col-md-11 col-sm-12 col-xs-12">

      <div class="row">
        <div class="col">
          <h1 class="huge-lecture-title my-5">
            <%= @lecture.title %>
          </h1>
        </div>
      </div>

      <div class="row ">
        <div class="col">
          <div id="lecture-discipline", class="border-bottom mb-4 text-secondary text-right">
            <%= link_to [:admin, @lecture.msu_discipline] do %>
            Дисциплина: <%= @lecture.msu_discipline.title %>
            <% end %>
          </div>
        </div>
      </div>

      <div class="row">
        <div class="col-10">
          <div id="lecture_content">
            <%= @lecture.content %>
          </div>
        </div>
      </div>

    </div>

    <div class="col-3 my-5">
      <div class=" my-3">
        <%= link_to [:edit, :admin, @lecture.msu_discipline, @lecture] do %>
          <button type="button" class="btn btn-outline-primary btn-block" >
            Редактировать лекцию
          </button>
        <% end %>
      </div>


      <div class="my-3 border-top border-bottom">
        <% if @lecture.msu_presentations.any? %>
          <div class="text-secondary text-center my-3">
            Презентации этой лекции:
          </div>
          <% @lecture.msu_presentations.each do |p| %>
            <%= render partial:'/admin/msu_presentations/presentation', object: p %>
          <% end %>
        <% else %>
          <div class="text-secondary text-center my-3">
            У этой лекции нет презентации
          </div>
        <% end %>


        <div class="my-3">

          <%= link_to [:new, :admin, @lecture, :msu_presentation],
            type: "button",
            class: "btn btn-outline-secondary btn-block",
            "data-toggle": "modal",
            "data-target": "#presModal",
            remote: true do %>
            Добавить презентацию
          <% end %>

        </div>
      </div>

      <div class=" my-3">
        <%= link_to [:admin, @lecture.msu_discipline, @lecture],
            method: :delete,
            data: { confirm: 'Are you sure?' } do %>
          <button type="button" class="btn btn-outline-danger btn-block align-self-center">
            Удалить лекцию
          </button>
        <% end %>
      </div>
  </div>
</div>
</div>

<script>
  $(document).ready(function(){
    $('#lecture_content').html(marked("<%= j @lecture.content %>"));

    $('p').each(function(){
      var alt = $(this).children('img').attr('alt');
      if (alt) {

        $(this).append("<div class='img-caption'>" + alt + "</div>");
      }
    });
  });
</script>
