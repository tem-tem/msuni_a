
  <div class="discipline-head w-100 border-bottom" style="background-color: #f9f9f9">

    <div class="d-flex flex-column mx-auto"
         style="max-width: 800px">

      <div class="mt-3 d-flex justify-content-between">

        <div class=" d-flex justify-content-between">
          <%= link_to admin_toggle_discipline_path(@discipline.id),
              remote: true,
              "data-toggle": "tooltip",
              "data-placement": "right",
              "title": "Отображать на сайте"  do %>
          <label class="switch my-auto">
            <input type="checkbox" id="toggleDiscipline-<%= @discipline.id %>" <%= @discipline.visible ? 'checked' : '' %>>
            <span class="slider round"></span>
          </label>
          <% end %>
        </div>
        <%= link_to [:admin, @discipline],
            method: :delete,
            class: "btn btn-outline-danger btn-sm",
              data: { confirm: 'Are you sure?' },
              type: "button",
              remote: true do %>
          Удалить дисциплину
          <% end %>
      </div>

      <div class="py-3">
        <h3 id="active-discipline-title" style="word-wrap: break-word;">
          <%= @discipline.title %>
        </h3>
      </div>
    </div>
      <!-- Nav menu -->
      <nav class="mx-auto" style="max-width: 800px;">
        <div class="nav nav-tabs border-0"
              id="nav-tab"
              role="tablist">
          <a class="nav-item nav-link active"
              id="nav-lecture-tab"
              data-toggle="tab"
              href="#nav-lectures"
              role="tab"
              aria-controls="nav-lectures"
              aria-selected="true">Лекции</a>
          <a class="nav-item nav-link"
              id="nav-books-tab"
              data-toggle="tab"
              href="#nav-books"
              role="tab"
              aria-controls="nav-books"
              aria-selected="true">Книги</a>
          <a class="nav-item nav-link"
              id="nav-videos-tab"
              data-toggle="tab"
              href="#nav-videos"
              role="tab"
              aria-controls="nav-videos"
              aria-selected="true">Видеоматериалы</a>
          <a class="nav-item nav-link"
              id="nav-presentations-tab"
              data-toggle="tab"
              href="#nav-presentations"
              role="tab"
              aria-controls="nav-presentations"
              aria-selected="true">Презентации</a>
        </div>
      </nav>
    <!-- END Nav menu -->
  </div>

  <div class="d-flex flex-column mx-auto" style="max-width:800px;">
      <!-- Nav content -->
      <div class="tab-content" id="nav-tabContent">
        <div class="tab-pane fade show active"
             id="nav-lectures"
             role="tabpanel"
             aria-labelledby="nav-lectures-tab">

          <div class="my-3 btn-group d-flex justify-content-end"
               role="group"
               aria-label="Lectures navigation">
            <button type="button"
                    class="btn btn-outline-info btn-sm"
                    data-toggle="modal"
                    data-target="#orderLectureModal" >
              Изменить порядок
            </button>
            <%= link_to [:new, :admin, @discipline, :msu_lecture],
                      class: "btn btn-outline-primary btn-sm",
                      type: "button",
                      "data-toggle": "modal",
                      "data-target": "#newLectureModal",
                      remote: true do %>
                Новая лекция
            <% end %>
          </div>

          <!-- Lectures list -->
          <div id="lectures">
              <% if @discipline.msu_lectures.any? %>
                <% @discipline.msu_lectures.each do |l| %>
                  <%= render partial: '/admin/msu_lectures/lecture', object: l %>
                <% end %>

                <!-- Order Lecture Modal -->
                <div class="modal fade bring-to-front" id="orderLectureModal"
                     tabindex="-1"
                     role="dialog"
                     aria-labelledby="orderLectureModal"
                     aria-hidden="true">
                  <div class="modal-dialog" role="document">
                    <div class="modal-content">
                      <div class="modal-header">
                        <div class="modal-title text-secondary" id="orderLectureModalLabel">Изменение порядка лекций</div>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                          <span aria-hidden="true">&times;</span>
                        </button>
                      </div>
                      <div class="modal-body col-10 align-self-center" id="orderLectureModalBody">

                        <ul id="orderLectureList">
                          <% @discipline.msu_lectures.each do |l| %>
                            <%= render partial: '/admin/msu_lectures/lecture_order', locals: {lecture: l} %>
                          <% end %>
                        </ul>

                      </div>
                      <div class="modal-footer">
                       <button type="button" class="btn btn-primary" id="newOrderButton" onclick="sendLecturesOrder()" >Сохранить изменения</button>
                     </div>
                    </div>
                  </div>
                </div>
                <!-- END Order Lecture Modal -->

              <% else %>
                <%= render partial: '/admin/empty' %>
              <% end %>
          </div>
          <!-- Lectures list end -->

        </div>

        <div class="tab-pane fade"
             href="nav-books"
             id="nav-books"
             role="tabpanel"
             aria-labelledby="nav-books-tab">

          <div class="my-3 d-flex justify-content-end"
               role="group"
               aria-label="Lectures navigation">
            <%= link_to [:new, :admin, @discipline, :msu_file, filetype: 'book'],
                      class: "btn btn-outline-primary btn-sm",
                      type: "button",
                      "data-toggle": "modal",
                      "data-target": "#itemModal",
                      remote: true do %>
                Добавить книгу
            <% end %>
          </div>

          <% if @discipline.msu_files.where(filetype: 'book').any? %>
            <% @discipline.msu_files.where(filetype: 'book').each_with_index do |book, index| %>
              <%= render partial: 'admin/msu_files/book', locals: {book: book, index: index + 1} %>
            <% end %>
          <% end %>

        </div>

        <div class="tab-pane fade"
             id="nav-videos"
             role="tabpanel"
             aria-labelledby="nav-videos-tab">видосы</div>
        <div class="tab-pane fade"
             id="nav-presentations"
             role="tabpanel"
             aria-labelledby="nav-presentations-tab">

          <% if @discipline.msu_lectures.any? %>
            <% @discipline.msu_lectures.each do |lec| %>
              <% if lec.msu_presentations.any? %>
              <small class="row col-6 my-4 text-secondary">
                <%= lec.title %>
              </small>
              <div class="row border-bottom">
                  <% lec.msu_presentations.each do |p| %>
                    <div class="col-4">
                      <%= render partial:'/admin/msu_presentations/presentation', object: p %>
                    </div>
                  <% end %>
              </div>
              <% end %>
            <% end %>
          <% end %>
        </div>
      </div>
      <!-- END Nav content -->

  </div>

  <!-- New Lecture Modal -->
  <div class="modal fade bring-to-front" id="itemModal"
       tabindex="-1"
       role="dialog"
       aria-labelledby="itemModal"
       aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <div class="modal-title text-secondary" id="itemModalLabel">Новая лекция</div>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body" id="itemModalBody">
          <!-- Здесь форма -->
        </div>
      </div>
    </div>
  </div>
  <!-- END New Lecture Modal -->

<script>
  $( function() {
    $( "#orderLectureList" ).sortable();
    $( "#orderLectureList" ).disableSelection();
  } );

  $(function () {
    $('[data-toggle="tooltip"]').tooltip()
  })

  function sendLecturesOrder() {
    var new_order = [];
    var d_id = "<%= @discipline.id %>";
    var url = "/admin/reorderlectures";

    $( ".lectureLi" ).each( function() {
      new_order.push( this.children['0'].value );
    });

    $.ajax({
      url: url,
      type: "GET",
      data: {
        new_order: new_order,
        id: d_id
      }
    });
  }
</script>
